
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SadiCoinTech Cricket SDC Betting</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  margin:0; font-family:Arial; background:#0b0f2c; color:#e5e7eb;
  transition: background 0.5s;
}
header {background:#020617; padding:18px; font-size:24px; font-weight:bold; text-align:center; box-shadow:0 2px 10px rgba(0,0,0,0.5);}
nav {display:flex; gap:15px; justify-content:center; padding:10px; background:#0f1225; border-bottom:1px solid #1c1f3a;}
nav a {color:#22c55e; text-decoration:none; font-weight:bold; transition: color 0.3s;}
nav a:hover {color:#2563eb;}
.container {display:flex; flex-wrap:wrap; padding:20px; gap:20px; max-width:1200px; margin:auto;}
.card {background:#11162c; border-radius:16px; padding:20px; flex:1 1 350px; box-shadow:0 10px 25px rgba(0,0,0,0.4); transition: transform 0.3s, box-shadow 0.3s;}
.card:hover {transform: translateY(-5px); box-shadow:0 15px 30px rgba(0,0,0,0.6);}
button {background:#22c55e; color:white; border:none; border-radius:10px; padding:10px; cursor:pointer; font-weight:bold; width:100%; transition: transform 0.2s;}
button:hover {opacity:0.9; transform: scale(1.05);}
input,select {padding:10px; border-radius:10px; border:none; margin:6px 0; width:100%;}
table {width:100%; border-collapse:collapse; margin-top:10px;}
th,td{border:1px solid #334155; padding:8px; text-align:center;}
footer{text-align:center; padding:20px; font-size:14px; opacity:0.7;}
.match-card {background:#1a1f3f; border-radius:12px; padding:15px; margin-bottom:15px; box-shadow:0 5px 15px rgba(0,0,0,0.4); transition: transform 0.3s;}
.match-card:hover {transform:scale(1.02);}
.match-header {display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;}
.match-teams {font-weight:bold; font-size:16px; color:#22c55e;}
.live-score {font-weight:bold; color:#ffb86b; transition: color 0.5s;}
.countdown {font-size:14px; color:#888;}
</style>
</head>
<body>

<header>üèè SadiCoinTech Cricket SDC Betting Dashboard</header>
<nav>
<a href="#live">Live Matches</a>
<a href="#leaderboard">Leaderboard</a>
<a href="#pdf">PDF Report</a>
</nav>

<div class="container">

<!-- LIVE MATCH PANEL -->
<div class="card" id="live">
<h2>Live Matches & SDC Predictions</h2>
<div id="matchesContainer">Loading live matches...</div>
</div>

<!-- LEADERBOARD -->
<div class="card" id="leaderboard">
<h2>Prediction Leaderboard</h2>
<table>
<thead><tr><th>User</th><th>Correct Predictions</th><th>SDC Won</th></tr></thead>
<tbody id="leaderboardTable"></tbody>
</table>
</div>

<!-- PDF EXPORT -->
<div class="card" id="pdf">
<button onclick="downloadPDF()">Download Betting Report PDF</button>
</div>

</div>
<footer>¬© SadiCoinTech Humanitarian Cricket Platform</footer>

<script>
// ---------------------- DATA ----------------------
const matches = []; 
const predictions = []; 

// ---------------------- LIVE MATCH FETCH ----------------------
const matchesContainer = document.getElementById("matchesContainer");

// Replace YOUR_CRICDATA_API_KEY with actual API key
async function fetchLiveMatches() {
  try {
    const resp = await fetch(`https://cricapi.com/api/matches?apikey=c7fcbc55-d199-4b75-8a3c-aa231ca6b7a1`);
    const data = await resp.json();
    matches.length = 0;
    if (data.matches && data.matches.length) {
      data.matches.forEach(m => matches.push({
        id:m.unique_id, teamA:m['team-1'], teamB:m['team-2'], date:new Date(m.date), liveScore:"N/A", started:false
      }));
      renderMatches();
    } else matchesContainer.innerHTML="No live matches currently.";
  } catch(e) { matchesContainer.innerHTML="Unable to fetch live matches.";}
}
fetchLiveMatches();
setInterval(fetchLiveMatches,15000);

// ---------------------- RENDER MATCHES ----------------------
function renderMatches() {
  matchesContainer.innerHTML="";
  matches.forEach(match => {
    const div=document.createElement("div");
    div.className="match-card";
    div.innerHTML=`
      <div class="match-header">
        <div class="match-teams">${match.teamA} vs ${match.teamB}</div>
        <div class="countdown" id="countdown-${match.id}"></div>
      </div>
      <div class="live-score" id="liveScore-${match.id}">${match.liveScore}</div>
      <input placeholder="User Name" class="userName" ${match.started?"disabled":""}>
      <input type="number" placeholder="SDC Tokens" class="userStake" ${match.started?"disabled":""}>
      <select class="userPick" ${match.started?"disabled":""}>
        <option value="A">${match.teamA} Win</option>
        <option value="B">${match.teamB} Win</option>
        <option value="D">Draw</option>
      </select>
      <button onclick="addPrediction('${match.id}', this)" ${match.started?"disabled":""}>Place Prediction</button>
      <div class="matchRewardOutput" style="margin-top:10px;"></div>
    `;
    matchesContainer.appendChild(div);
    startCountdown(match);
  });
}

// ---------------------- COUNTDOWN ----------------------
function startCountdown(match){
  const cdEl=document.getElementById(`countdown-${match.id}`);
  const timer=setInterval(()=>{
    const now=new Date();
    let diff=Math.floor((match.date-now)/1000);
    if(diff<=0){ cdEl.textContent="LIVE"; match.started=true; clearInterval(timer); updateMatchInputs(match.id,false); return;}
    const h=Math.floor(diff/3600), m=Math.floor((diff%3600)/60), s=diff%60;
    cdEl.textContent=`Starts in ${h}h ${m}m ${s}s`;
  },1000);
}

// Disable/enable inputs when match starts
function updateMatchInputs(matchId, enabled){
  const card=document.querySelector(`[onclick="addPrediction('${matchId}', this)"]`).parentElement;
  card.querySelectorAll("input,select,button").forEach(el=>el.disabled=!enabled);
}

// ---------------------- ADD PREDICTION ----------------------
function addPrediction(matchId, btn){
  const card=btn.parentElement;
  const user=card.querySelector(".userName").value.trim();
  const stake=+card.querySelector(".userStake").value;
  const pick=card.querySelector(".userPick").value;
  const output=card.querySelector(".matchRewardOutput");
  if(!user||!stake){ alert("Enter valid user and stake"); return;}
  predictions.push({matchId,user,stake,pick,reward:0});
  output.textContent=`Prediction placed: ${user} ‚Üí ${pick} (${stake} SDC)`;
  renderLeaderboard();
}

// ---------------------- SIMULATE MATCH RESULTS ----------------------
// In real app, this should come from CricAPI live score & result endpoint
function simulateMatchResult(matchId){
  const match=Math.random()>0.5 ? 'A':'B'; // simulate random winner
  distributeRewards(matchId,match);
}

// ---------------------- DISTRIBUTE REWARDS ----------------------
function distributeRewards(matchId,result){
  const matchPredictions=predictions.filter(p=>p.matchId===matchId);
  const totalPool=matchPredictions.reduce((s,p)=>s+p.stake,0);
  const winners=matchPredictions.filter(p=>p.pick===result);
  const correctTotal=winners.reduce((s,p)=>s+p.stake,0);
  const aidFund=totalPool*0.1;
  winners.forEach(w=>{
    w.reward=((w.stake/correctTotal)*(totalPool-aidFund)).toFixed(2);
  });
  renderLeaderboard();
}

// ---------------------- LEADERBOARD ----------------------
function renderLeaderboard(){
  const tbody=document.getElementById("leaderboardTable");
  tbody.innerHTML="";
  const userStats={};
  predictions.forEach(p=>{
    if(!userStats[p.user]) userStats[p.user]={correct:0,SDC:0};
    if(p.reward>0){ userStats[p.user].correct++; userStats[p.user].SDC+=+p.reward;}
  });
  Object.keys(userStats).forEach(u=>{
    tbody.innerHTML+=`<tr><td>${u}</td><td>${userStats[u].correct}</td><td>${userStats[u].SDC.toFixed(2)}</td></tr>`;
  });
}

// ---------------------- PDF EXPORT ----------------------
async function downloadPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  pdf.text("SadiCoinTech Cricket Betting Report",20,20);
  pdf.text("Matches & Predictions:",20,30);
  let y=40;
  matches.forEach(m=>{
    pdf.text(`${m.teamA} vs ${m.teamB}`,20,y); y+=6;
    predictions.filter(p=>p.matchId===m.id).forEach(p=>{
      pdf.text(`  ${p.user} ‚Üí ${p.pick} (${p.stake} SDC) Reward: ${p.reward}`,25,y); y+=6;
    });
  });
  pdf.text("Leaderboard:",20,y+10);
  const leaderboardRows=document.querySelectorAll("#leaderboardTable tr");
  let ly=y+20;
  leaderboardRows.forEach(row=>{
    const cols=row.querySelectorAll("td");
    if(cols.length>0){
      pdf.text(`${cols[0].innerText} | Correct: ${cols[1].innerText} | SDC Won: ${cols[2].innerText}`,20,ly);
      ly+=6;
    }
  });
  pdf.text("¬© SadiCoinTech Humanitarian Cricket Platform",50,280);
  pdf.save("SadiCoinTech_Betting_Report.pdf");
}
</script>
</body>
</html>