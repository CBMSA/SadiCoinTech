<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PhotoChat – Web3 Marketplace & SadiPay Super App</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body { background:#05070d; color:#e5e7eb; font-family:'Inter', system-ui; margin:0; }
.loading-screen { position:fixed; inset:0; background:#020617; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:9999; }
.loading-logo { font-size:32px; font-weight:700; color:#22c55e; margin-bottom:16px; letter-spacing:1px; animation: pulse 1.5s infinite; }
.loading-sub { font-size:14px; color:#9ca3af; }
@keyframes pulse { 0%,100%{transform:scale(1);}50%{transform:scale(1.1);} }
.app { max-width:420px; margin:auto; height:100vh; display:flex; flex-direction:column; border-radius:16px; overflow:hidden; box-shadow:0 4px 20px rgba(0,0,0,0.6); }
.header { background:#0b0f1a; padding:14px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #111827; }
.logo { font-weight:700; color:#22c55e; font-size:20px; }
.chat-feed { flex:1; overflow-y:auto; background:#111827; padding:12px; display:flex; flex-direction:column; gap:6px; }
.msg { padding:10px 16px; border-radius:20px; max-width:70%; position:relative; font-size:14px; line-height:1.3; }
.msg.user { background:linear-gradient(90deg, #22c55e,#16a34a); color:#000; align-self:flex-end; }
.msg.system { background:#1f2937; color:#e5e7eb; align-self:flex-start; }
.msg-timestamp { font-size:10px; color:#9ca3af; margin-top:2px; text-align:right; }
.input-bar { display:flex; gap:8px; padding:10px; border-top:1px solid #111827; background:#0b0f1a; }
.input-bar input { flex:1; border-radius:24px; padding:12px; border:none; background:#1f2937; color:#e5e7eb; }
.input-bar button { border:none; border-radius:24px; padding:0 16px; background:#22c55e; color:#000; font-weight:600; cursor:pointer; transition:0.2s; }
.input-bar button:hover { background:#16a34a; }
.navbar-app { display:flex; gap:6px; padding:8px; background:#0b0f1a; justify-content:space-around; border-top:1px solid #111827; }
.navbar-app button { flex:1; background:#111827; border:none; color:#9ca3af; padding:10px 0; border-radius:12px; font-weight:600; transition:0.2s; }
.navbar-app button:hover { background:#22c55e; color:#000; transform:scale(1.05); }
.footer { text-align:center; padding:6px; font-size:12px; background:#020617; color:#6b7280; }
.shop-card { background:#1f2937; padding:12px; border-radius:16px; margin:6px 0; transition:0.2s; }
.shop-card:hover { transform:translateY(-3px); box-shadow:0 6px 12px rgba(0,0,0,0.5); }
.virtual-card { background: linear-gradient(145deg, #000000, #1a1a1a); border-radius:20px; padding:20px 24px; margin:12px; color:#FFD700; font-family:'Courier New', Courier, monospace; position:relative; box-shadow:0 8px 20px rgba(0,0,0,0.7); perspective:1000px; transition:0.3s; cursor:pointer; }
.virtual-card-inner { transition: transform 0.8s; transform-style: preserve-3d; position: relative; }
.virtual-card.flipped .virtual-card-inner { transform: rotateY(180deg); }
.virtual-card-front, .virtual-card-back { backface-visibility: hidden; }
.virtual-card-back { position:absolute; top:0; left:0; width:100%; height:100%; background:#111; border-radius:20px; color:#FFD700; display:flex; flex-direction:column; justify-content:center; align-items:center; transform: rotateY(180deg); }
.virtual-card .card-logo { font-weight:700; font-size:20px; color:#FFD700; margin-bottom:16px; letter-spacing:1px; }
.virtual-card .card-number { font-size:22px; letter-spacing:3px; margin-bottom:12px; }
.virtual-card .card-holder { display:flex; justify-content:space-between; font-size:12px; color:#FFD700; }
.virtual-card .valid-thru { font-size:10px; color:#FFD700; }
.virtual-card .small-text { position:absolute; bottom:12px; right:12px; font-size:12px; color:#FFD700; }
</style>
</head>
<body>

<div class="loading-screen" id="loadingScreen">
  <div class="loading-logo">SadiCoinTech</div>
  <div class="loading-sub">Opening PhotoChat...</div>
</div>

<div class="app" style="display:none" id="appRoot">
<div class="header">
<div class="logo">PhotoChat</div>
<div id="userLabel">Guest</div>
</div>
<div id="appContent" style="flex:1; display:flex; flex-direction:column">

<div class="virtual-card" onclick="flipCard()">
  <div class="virtual-card-inner">
    <div class="virtual-card-front">
      <div class="card-logo">SadiPay</div>
      <div class="card-number">•••• •••• •••• 1234</div>
      <div class="card-holder">
        <div>John Doe</div>
        <div class="valid-thru">VALID THRU 12/26</div>
      </div>
      <div class="small-text" id="cardBalance">SDC Balance: 0.00</div>
    </div>
    <div class="virtual-card-back">
      <div>Card Details</div>
      <div id="cardTransactions">No transactions yet.</div>
    </div>
  </div>
</div>

<div class="chat-feed" id="chatFeed"></div>
<div class="p-2">
<input id="aiInput" class="form-control mb-1" placeholder="Ask SDC AI anonymously...">
<button class="btn btn-success w-100" onclick="askAI()">Ask AI</button>
</div>

<div id="miniShop">
<h6 class="ms-2">Marketplace</h6>
<input id="itemSearch" class="form-control mb-2" placeholder="Search items..." oninput="loadShop()">
<div id="shopItems"></div>
</div>

<div class="input-bar">
<input id="msgInput" placeholder="Send money or message">
<button onclick="requireAuth(sendMessage)">Send</button>
</div>

<div class="navbar-app">
<button>Chat</button>
<button>Trends</button>
<button>News</button>
<button>Finance</button>
</div>

<div class="footer">© <span id="year"></span> SadiCoinTech</div>
</div>
</div>

<div class="modal-bg" id="authModal">
  <div class="modal-box">
    <h5>Complete Verification</h5>
    <input id="phone" class="form-control mb-2" placeholder="Phone number">
    <input id="bank" class="form-control mb-2" placeholder="Bank account number">
    <input id="idnum" class="form-control mb-2" placeholder="ID or Passport">
    <button class="btn btn-success w-100" onclick="saveUserDetails()">Save & Continue</button>
  </div>
</div>

<script>
let sb;
try { sb = supabase.createClient("YOUR_SUPABASE_URL","YOUR_SUPABASE_KEY"); } catch { console.log("Supabase not connected — demo mode."); }
const OPENAI_API = "/api/ai";
let currentUser=null;
let pendingAction=null;
document.getElementById("year").innerText = new Date().getFullYear();

/* 3-second loader FIX */
document.addEventListener("DOMContentLoaded", function() {
  const loader = document.getElementById("loadingScreen");
  const app = document.getElementById("appRoot");
  if(!loader || !app) return;
  setTimeout(() => { loader.style.display = "none"; app.style.display = "flex"; }, 3000);
});

function requireAuth(action){ if(!currentUser){ pendingAction = action; authModal.style.display="flex"; } else { action(); } }

async function saveUserDetails(){ if(!sb){ currentUser={ phone: phone.value }; userLabel.innerText=phone.value; authModal.style.display="none"; if(pendingAction) pendingAction(); return; }
const {data,error}=await sb.from("users").insert({ phone: phone.value, bank_account: bank.value, id_number: idnum.value }).select().single();
if(error) return alert(error.message);
currentUser=data; userLabel.innerText=phone.value; authModal.style.display="none"; if(pendingAction) pendingAction(); }

async function sendMessage(){ const timestamp = new Date().toLocaleTimeString(); const div = document.createElement("div"); div.className="msg user"; div.innerHTML=msgInput.value+`<div class='msg-timestamp'>${timestamp}</div>`; chatFeed.appendChild(div); msgInput.value=''; chatFeed.scrollTop=chatFeed.scrollHeight; }

async function askAI(){ const question=aiInput.value; if(!question) return; try{ const res=await fetch(OPENAI_API,{ method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({ message:question }) }); const data=await res.json(); const div=document.createElement("div"); div.className="msg system"; div.innerHTML=data.reply||"AI unavailable"; div.innerHTML += `<div class='msg-timestamp'>${new Date().toLocaleTimeString()}</div>`; chatFeed.appendChild(div); chatFeed.scrollTop=chatFeed.scrollHeight; } catch { const div=document.createElement("div"); div.className="msg system"; div.innerText="AI connection not configured."; chatFeed.appendChild(div); } }

function flipCard(){ document.querySelector('.virtual-card').classList.toggle('flipped'); }

let balance = 0;
function updateBalance(amount){ balance += amount; document.getElementById('cardBalance').innerText = `SDC Balance: ${balance.toFixed(2)}`; }

async function loadShop(){ if(!sb){ shopItems.innerHTML=`<div class='shop-card'><img src='https://via.placeholder.com/150?text=Sadi+T-Shirt'><b>Sadi T-Shirt</b><br>100 SDC<br><button class='btn btn-sm btn-success' onclick='requireAuth(()=>buyItem(1))'>Buy</button></div>
<div class='shop-card'><img src='https://via.placeholder.com/150?text=Sadi+Hoodie'><b>Sadi Hoodie</b><br>150 SDC<br><button class='btn btn-sm btn-success' onclick='requireAuth(()=>buyItem(2))'>Buy</button></div>
<div class='shop-card'><img src='https://via.placeholder.com/150?text=Sadi+Mug'><b>Sadi Mug</b><br>50 SDC<br><button class='btn btn-sm btn-success' onclick='requireAuth(()=>buyItem(3))'>Buy</button></div>
<div class='shop-card'><img src='https://via.placeholder.com/150?text=Sadi+Cap'><b>Sadi Cap</b><br>80 SDC<br><button class='btn btn-sm btn-success' onclick='requireAuth(()=>buyItem(4))'>Buy</button></div>
<div class='shop-card'><img src='https://via.placeholder.com/150?text=Sadi+NFT+Art'><b>Sadi NFT Art</b><br>500 SDC<br><button class='btn btn-sm btn-success' onclick='requireAuth(()=>buyItem(5))'>Buy</button></div>`; return; }
const search=itemSearch.value||"";
const {data}=await sb.from("shop_items").select("*").ilike("title",`%${search}%`);
shopItems.innerHTML=data?.map(i=>`<div class='shop-card'><b>${i.title}</b><br>${i.price} ${i.currency}<br><button class='btn btn-sm btn-success' onclick='requireAuth(()=>buyItem(${i.id}))'>Buy</button></div>`).join(''); }
async function buyItem(id){ alert("Proceed to secure transaction flow."); updateBalance(10); }
loadShop();
</script>

</body>
</html>
